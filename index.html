<!doctype html>
<html lang="es">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üß† BRAINROTS STORE üéÆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes bounce-in {
            0% { transform: scale(0) rotate(180deg); opacity: 0; }
            50% { transform: scale(1.2) rotate(90deg); opacity: 0.8; }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }
        
        @keyframes slide-in {
            0% { transform: translateX(-100px); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.4); }
            50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.8); }
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        @keyframes colorShift {
            0% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
            20% { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
            40% { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
            60% { background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); }
            80% { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
            100% { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        }
        
        .dynamic-bg {
            animation: colorShift 10s ease-in-out infinite;
        }
        
        .float { animation: float 3s ease-in-out infinite; }
        .bounce-in { animation: bounce-in 0.8s ease-out; }
        .slide-in { animation: slide-in 0.6s ease-out; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        
        .rainbow-bg {
            background: linear-gradient(-45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
            background-size: 400% 400%;
            animation: rainbow 4s ease infinite;
        }
        
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
        }
        
        .btn-bounce {
            transition: all 0.2s ease;
        }
        
        .btn-bounce:hover {
            transform: scale(1.1);
        }
        
        .btn-bounce:active {
            transform: scale(0.95);
        }
        
        .emoji-spin {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .emoji-spin:hover {
            transform: rotate(360deg);
        }
        
        .notification {
            animation: slide-in 0.5s ease-out;
        }

        .sold-out-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }

        .discount-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(45deg, #ff4444, #ff6b6b);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            z-index: 5;
            animation: pulse-glow 2s ease-in-out infinite;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="min-h-full dynamic-bg"><!-- Header -->
  <header class="text-center py-8 px-4">
   <div class="float">
    <h1 id="storeTitle" class="text-6xl font-black text-transparent bg-clip-text rainbow-bg mb-4">BRAINROTS STORE üéÆ</h1>
   </div>
   <p id="storeSubtitle" class="text-2xl text-white font-bold slide-in">La forma m√°s f√°cil de conseguir tus brainrots favoritosü§ë</p>
  </header><!-- Main Catalog Section -->
  <main id="catalogSection" class="container mx-auto px-4 pb-12">
   <div class="text-center mb-12">
    <h2 class="text-4xl font-black text-yellow-300 mb-4 pulse-glow">üëª CAT√ÅLOGO DE BRAINROTS üëª</h2><!-- Search Bar -->
    <div class="max-w-md mx-auto mb-8">
     <div class="relative"><input type="text" id="searchInput" placeholder="üîç Buscar brainrots..." class="w-full px-6 py-4 pl-12 rounded-2xl bg-white/20 backdrop-blur-xl text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg font-bold">
      <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-2xl">
       üîç
      </div><button id="clearSearch" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-2xl hover:scale-110 transition-transform hidden">‚ùå</button>
     </div>
    </div>
   </div>
   <div id="productsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"><!-- Products will be rendered here -->
   </div><!-- No Results Message -->
   <div id="noResults" class="hidden text-center py-12">
    <div class="text-6xl mb-4">
     üòµ
    </div>
    <h3 class="text-3xl font-black text-yellow-300 mb-2">¬°No encontramos nada!</h3>
    <p class="text-xl text-white">Intenta buscar con otro nombre üîç</p>
   </div><!-- Gift Button at the bottom -->
   <div class="text-center mt-16"><button id="showGiftsBtn" class="bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 px-8 py-4 rounded-xl font-black text-xl btn-bounce shadow-lg"> <span class="emoji-spin">üéÅ</span> CANJEAR REGALOS </button>
   </div>
  </main><!-- Gifts Section -->
  <section id="giftsSection" class="hidden container mx-auto px-4 pb-12">
   <div class="max-w-2xl mx-auto">
    <div class="text-center mb-8"><button id="backToCatalogFromGifts" class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 px-6 py-3 rounded-xl font-black text-white btn-bounce mb-6"> ‚Üê VOLVER AL CAT√ÅLOGO </button>
     <h2 class="text-4xl font-black text-yellow-300 mb-4">üéÅ CANJEAR REGALOS</h2>
     <p class="text-xl text-white">¬°Ingresa tu c√≥digo y obt√©n productos gratis!</p>
    </div>
    <form id="giftForm" class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 border-4 border-yellow-300">
     <div class="mb-6"><label for="giftCode" class="block text-xl font-bold text-yellow-300 mb-2"> üé´ C√≥digo de Regalo: </label> <input type="text" id="giftCode" required class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg" placeholder="Ingresa tu c√≥digo aqu√≠">
     </div>
     <div class="mb-6"><label for="giftCustomerName" class="block text-xl font-bold text-yellow-300 mb-2"> üë§ Tu Nombre Real: </label> <input type="text" id="giftCustomerName" required class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg">
     </div>
     <div class="mb-8"><label for="giftRobloxName" class="block text-xl font-bold text-yellow-300 mb-2"> üéÆ Tu Usuario de Roblox: </label> <input type="text" id="giftRobloxName" required class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg">
     </div><button type="submit" class="w-full bg-gradient-to-r from-pink-400 to-purple-500 hover:from-pink-500 hover:to-purple-600 px-8 py-4 rounded-xl font-black text-2xl btn-bounce"> <span class="emoji-spin">üéÅ</span> CANJEAR REGALO </button>
    </form>
   </div>
  </section><!-- Purchase Form Section -->
  <section id="purchaseSection" class="hidden container mx-auto px-4 pb-12">
   <div class="max-w-2xl mx-auto">
    <div class="text-center mb-8"><button id="backToCatalog" class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 px-6 py-3 rounded-xl font-black text-white btn-bounce mb-6"> ‚Üê VOLVER AL CAT√ÅLOGO </button>
     <h2 class="text-4xl font-black text-yellow-300 mb-4">üõí FINALIZAR COMPRA</h2>
     <div id="selectedProductInfo" class="bg-white/10 rounded-xl p-6 mb-8"><!-- Selected product info will be shown here -->
     </div>
    </div>
    <form id="purchaseForm" class="bg-white/10 backdrop-blur-xl rounded-3xl p-8 border-4 border-yellow-300">
     <div class="mb-6"><label for="customerName" class="block text-xl font-bold text-yellow-300 mb-2"> üë§ Tu Nombre Real: </label> <input type="text" id="customerName" required class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg">
     </div>
     <div class="mb-8"><label for="robloxName" class="block text-xl font-bold text-yellow-300 mb-2"> üéÆ Tu Usuario de Roblox: </label> <input type="text" id="robloxName" required class="w-full px-4 py-3 rounded-xl bg-white/20 text-white placeholder-gray-300 border-2 border-purple-400 focus:border-yellow-300 focus:outline-none text-lg">
     </div><button type="submit" class="w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 px-8 py-4 rounded-xl font-black text-2xl btn-bounce"> <span class="emoji-spin">üì±</span> HACER EL PEDIDOü•≥ </button>
    </form>
   </div>
  </section><!-- Success Message -->
  <div id="successMessage" class="hidden fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-green-400 to-blue-500 text-white px-8 py-6 rounded-3xl shadow-2xl z-50 notification">
   <div class="text-center">
    <div class="text-4xl mb-4">
     üéâ
    </div>
    <p class="text-xl font-bold">MUCHAS GRACIAS POR EL PEDIDO, TE CONTACTAREMOS PRONTOüëªüëæ</p>
   </div>
  </div>
  <script>
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéØ CONFIGURACI√ìN S√öPER F√ÅCIL - CAMBIA AQU√ç TODO üéØ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Configuraci√≥n por defecto
        const defaultConfig = {
            store_title: "BRAINROTS STORE üéÆ",
            store_subtitle: "La forma m√°s f√°cil de conseguir tus brainrots favoritosü§ë",
            whatsapp_number: "573245640954"
        };

        // üéÅ C√ìDIGOS DE REGALO ACTIVOS (AGREGA/QUITA AQU√ç)
        let giftCodes = [
            {
                code: "REGALO2024", // üé´ NOMBRE DEL C√ìDIGO
                stock: 5, // üì¶ CU√ÅNTAS VECES SE PUEDE USAR
                productId: 1 // üéÆ ID DEL PRODUCTO
            },
            {
                code: "NAVIDAD", // üé´ OTRO C√ìDIGO
                stock: 3, // üì¶ STOCK
                productId: 6 // üéÆ JOB JOB JOB SAHUR
            }
        ];

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üéÆ PRODUCTOS SIMPLIFICADOS - EDITA AQU√ç üéÆ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        let products = [
            {
                id: 1,
                name: "TRALALITA TRALALA",
                image: "tralalita.jpg",
                description: "¬°El incre√≠ble TRALALITA TRALALA! ¬°Un brainrot s√∫per genial que te va a encantar!",
                price: 3000,
                stock: 5,
                discount: 0
            },
            {
                id: 2,
                name: "TRALALERO TRALALA",
                image: "tralaleroTralala.jpg",
                description: "¬°El genial TRALALERO TRALALA! ¬°S√∫per divertido y √∫nico!",
                price: 3000,
                stock: 4,
                discount: 0
            },
            {
                id: 3,
                name: "LOS BOMBINITOS",
                image: "los bombinitos.jpg",
                description: "¬°Los incre√≠bles BOMBINITOS! ¬°S√∫per explosivos y geniales!",
                price: 6000,
                stock: 0,
                discount: 0
            },
            {
                id: 4,
                name: "LOS COCODRILITOS",
                image: "noFilter.jpg",
                description: "¬°Los fant√°sticos COCODRILITOS! ¬°S√∫per salvajes y divertidos!",
                price: 3500,
                stock: 7,
                discount: 0
            },
            {
                id: 5,
                name: "LOS ORCALITOS",
                image: "noFilter (1).jpg",
                description: "¬°Los espectaculares ORCALITOS! ¬°S√∫per marinos y geniales!",
                price: 8000,
                stock: 3,
                discount: 0
            },
            {
                id: 6,
                name: "JOB JOB JOB SAHUR",
                image: "job.jpg",
                description: "¬°El legendario JOB JOB JOB SAHUR! ¬°El m√°s √©pico de todos!",
                price: 10000,
                stock: 2,
                discount: 0
            },
            {
                id: 7,
                name: "MATEO",
                image: "matteofr.jpg",
                description: "¬°El incre√≠ble MATEO! ¬°S√∫per √∫nico y especial!",
                price: 3500,
                stock: 4,
                discount: 0
            },
            {
                id: 8,
                name: "PAKRAHMATMAMAT",
                image: "pakrah.jpg",
                description: "¬°El asombroso PAKRAHMATMAMAT! ¬°S√∫per misterioso y genial!",
                price: 5000,
                stock: 5,
                discount: 0
            },
            {
                id: 9,
                name: "LA VACA SATURNO SATURNITA",
                image: "noFilter (2).jpg",
                description: "¬°La incre√≠ble VACA SATURNO SATURNITA! ¬°S√∫per espacial y genial!",
                price: 7000,
                stock: 3,
                discount: 0
            },
            {
                id: 10,
                name: "LOS TIPI TACOS",
                image: "Los_tipi_tacos.jpg",
                description: "¬°Los incre√≠bles TIPI TACOS! ¬°S√∫per sabrosos y geniales!",
                price: 10000,
                stock: 4,
                discount: 0
            }
        ];

        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üöÄ C√ìDIGO AUTOM√ÅTICO - NO TOCAR üöÄ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

        // Get all the elements we need
        const catalogSection = document.getElementById('catalogSection');
        const purchaseSection = document.getElementById('purchaseSection');
        const productsGrid = document.getElementById('productsGrid');
        const selectedProductInfo = document.getElementById('selectedProductInfo');
        const backToCatalog = document.getElementById('backToCatalog');
        const purchaseForm = document.getElementById('purchaseForm');
        const successMessage = document.getElementById('successMessage');
        const searchInput = document.getElementById('searchInput');
        const clearSearch = document.getElementById('clearSearch');
        const noResults = document.getElementById('noResults');

        // Gift elements
        const showGiftsBtn = document.getElementById('showGiftsBtn');
        const giftsSection = document.getElementById('giftsSection');
        const backToCatalogFromGifts = document.getElementById('backToCatalogFromGifts');
        const giftForm = document.getElementById('giftForm');

        let currentProduct = null;
        let orders = [];
        let filteredProducts = [...products];

        // Inicializar Element SDK
        async function initializeElementSDK() {
            if (window.elementSdk) {
                try {
                    await window.elementSdk.init({
                        defaultConfig,
                        onConfigChange: async (config) => {
                            // Actualizar t√≠tulo de la tienda
                            const titleElement = document.getElementById('storeTitle');
                            if (titleElement) {
                                titleElement.textContent = config.store_title || defaultConfig.store_title;
                            }
                            
                            // Actualizar subt√≠tulo
                            const subtitleElement = document.getElementById('storeSubtitle');
                            if (subtitleElement) {
                                subtitleElement.textContent = config.store_subtitle || defaultConfig.store_subtitle;
                            }
                        },
                        mapToCapabilities: (config) => ({
                            recolorables: [],
                            borderables: [],
                            fontEditable: undefined,
                            fontSizeable: undefined
                        }),
                        mapToEditPanelValues: (config) => new Map([
                            ["store_title", config.store_title || defaultConfig.store_title],
                            ["store_subtitle", config.store_subtitle || defaultConfig.store_subtitle],
                            ["whatsapp_number", config.whatsapp_number || defaultConfig.whatsapp_number]
                        ])
                    });
                } catch (error) {
                    console.error("Error inicializando Element SDK:", error);
                }
            }
        }

        // Funci√≥n para obtener n√∫mero de WhatsApp
        function getWhatsAppNumber() {
            if (window.elementSdk && window.elementSdk.config) {
                return window.elementSdk.config.whatsapp_number || defaultConfig.whatsapp_number;
            }
            return defaultConfig.whatsapp_number;
        }

        // Utility functions
        function formatPrice(price) {
            return $${price.toLocaleString('es-CO')};
        }

        function calculateDiscountedPrice(originalPrice, discountPercent) {
            return Math.round(originalPrice * (1 - discountPercent / 100));
        }

        function showSuccessOnReturn() {
            let isHidden = false;
            
            document.addEventListener('visibilitychange', function() {
                if (document.hidden) {
                    isHidden = true;
                } else if (isHidden) {
                    showSuccess();
                    isHidden = false;
                }
            });

            window.addEventListener('blur', function() {
                isHidden = true;
            });

            window.addEventListener('focus', function() {
                if (isHidden) {
                    showSuccess();
                    isHidden = false;
                }
            });
        }

        // Gift navigation
        showGiftsBtn.addEventListener('click', () => {
            catalogSection.classList.add('hidden');
            giftsSection.classList.remove('hidden');
        });

        backToCatalogFromGifts.addEventListener('click', () => {
            giftsSection.classList.add('hidden');
            catalogSection.classList.remove('hidden');
        });

        // Search functionality
        function filterProducts(searchTerm) {
            if (!searchTerm.trim()) {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(product => 
                    product.name.toLowerCase().includes(searchTerm.toLowerCase())
                );
            }
            renderCatalog();
        }

        // Search event listeners
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value;
            filterProducts(searchTerm);
            
            if (searchTerm.trim()) {
                clearSearch.classList.remove('hidden');
            } else {
                clearSearch.classList.add('hidden');
            }
        });

        clearSearch.addEventListener('click', () => {
            searchInput.value = '';
            clearSearch.classList.add('hidden');
            filterProducts('');
        });

        // Navigation event listeners
        backToCatalog.addEventListener('click', () => {
            purchaseSection.classList.add('hidden');
            catalogSection.classList.remove('hidden');
            currentProduct = null;
        });

        // Render main catalog
        function renderCatalog() {
            const productsToShow = filteredProducts.length > 0 ? filteredProducts : products;
            
            if (productsToShow.length === 0) {
                productsGrid.innerHTML = '';
                noResults.classList.remove('hidden');
                return;
            } else {
                noResults.classList.add('hidden');
            }
            
            productsGrid.innerHTML = productsToShow.map((product, index) => {
                const hasDiscount = product.discount > 0;
                const originalPrice = product.price;
                const discountedPrice = hasDiscount ? calculateDiscountedPrice(originalPrice, product.discount) : originalPrice;
                const isOutOfStock = product.stock === 0;
                
                return `
                <div class="card-hover bg-gradient-to-br from-purple-800/80 to-pink-800/80 backdrop-blur-xl rounded-3xl overflow-hidden border-4 border-yellow-300 shadow-2xl bounce-in relative" style="animation-delay: ${index * 0.1}s">
                    ${isOutOfStock ? `
                        <div class="sold-out-overlay rounded-3xl">
                            <div class="text-center">
                                <div class="text-6xl mb-4">üòµ</div>
                                <div class="text-3xl font-black text-red-400">AGOTADO</div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- PRODUCT NAME -->
                    <div class="p-6 pb-4">
                        <h3 class="text-2xl font-black text-yellow-300 text-center">${product.name}</h3>
                    </div>
                    
                    <!-- PRODUCT IMAGE -->
                    <div class="relative overflow-hidden mx-6 mb-4">
                        ${hasDiscount ? <div class="discount-badge">üî• ${product.discount}% OFF</div> : ''}
                        <div class="w-full h-56 bg-gradient-to-br from-pink-500 to-purple-600 rounded-xl flex items-center justify-center relative">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover transition-all duration-500 hover:scale-110 rounded-xl absolute inset-0" onload="this.style.opacity='1'; this.nextElementSibling.style.display='none';" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" style="opacity: 0; transition: opacity 0.5s;">
                            <div class="flex flex-col items-center justify-center text-white w-full h-full">
                                <span class="text-4xl mb-2">üñº</span>
                                <span class="font-bold text-center px-4">${product.name}</span>
                            </div>
                        </div>
                        ${!hasDiscount && !isOutOfStock ? `
                            <div class="absolute top-4 right-4 bg-yellow-400 text-black px-3 py-1 rounded-full font-black text-sm">
                                ¬°NUEVO!
                            </div>
                        ` : ''}
                    </div>
                    
                    <!-- PRICE AND STOCK -->
                    <div class="px-6 pb-4">
                        <div class="text-center bg-green-500/20 rounded-xl py-3 mb-4">
                            ${hasDiscount ? `
                                <div class="text-lg font-bold text-red-400 line-through">${formatPrice(originalPrice)}</div>
                                <div class="text-3xl font-black text-green-300">${formatPrice(discountedPrice)}</div>
                            ` : `
                                <span class="text-3xl font-black text-green-300">${formatPrice(originalPrice)}</span>
                            `}
                        </div>
                        <div class="text-center mb-4">
                            <span class="text-lg font-bold ${product.stock > 3 ? 'text-green-400' : product.stock > 0 ? 'text-yellow-400' : 'text-red-400'}">
                                üì¶ Stock: ${product.stock} ${product.stock === 1 ? 'unidad' : 'unidades'}
                            </span>
                        </div>
                    </div>
                    
                    <!-- BUY BUTTON -->
                    <div class="p-6 pt-0">
                        ${!isOutOfStock ? `
                            <button onclick="buyProduct(${product.id})" class="w-full bg-gradient-to-r from-green-400 to-blue-500 hover:from-green-500 hover:to-blue-600 px-6 py-4 rounded-xl font-black text-xl btn-bounce shadow-lg">
                                <span class="emoji-spin">üí≥</span> ¬°COMPRAR AHORA!
                            </button>
                        ` : `
                            <button disabled class="w-full bg-gray-600 px-6 py-4 rounded-xl font-black text-xl opacity-50 cursor-not-allowed">
                                üòµ AGOTADO
                            </button>
                        `}
                    </div>
                </div>
            `;}).join('');
        }

        // Buy product directly
        function buyProduct(productId) {
            currentProduct = products.find(p => p.id === productId);
            if (!currentProduct || currentProduct.stock === 0) return;
            
            const hasDiscount = currentProduct.discount > 0;
            const originalPrice = currentProduct.price;
            const discountedPrice = hasDiscount ? calculateDiscountedPrice(originalPrice, currentProduct.discount) : originalPrice;
            
            selectedProductInfo.innerHTML = `
                <h3 class="text-3xl font-black text-yellow-300 mb-2">${currentProduct.name}</h3>
                <p class="text-lg text-white mb-4">${currentProduct.description}</p>
                ${hasDiscount ? `
                    <div class="mb-2">
                        <span class="text-lg text-red-400 line-through">${formatPrice(originalPrice)}</span>
                        <span class="ml-2 bg-red-500 text-white px-2 py-1 rounded text-sm font-bold">üî• ${currentProduct.discount}% OFF</span>
                    </div>
                    <p class="text-2xl font-bold text-green-400">${formatPrice(discountedPrice)}</p>
                ` : `
                    <p class="text-2xl font-bold text-green-400">${formatPrice(originalPrice)}</p>
                `}
                <p class="text-lg text-white mt-2">Stock disponible: ${currentProduct.stock} ${currentProduct.stock === 1 ? 'unidad' : 'unidades'}</p>
            `;
            
            catalogSection.classList.add('hidden');
            purchaseSection.classList.remove('hidden');
            purchaseSection.scrollIntoView({ behavior: 'smooth' });
        }

        // Handle gift form
        giftForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const giftCode = document.getElementById('giftCode').value.toLowerCase();
            const customerName = document.getElementById('giftCustomerName').value;
            const robloxName = document.getElementById('giftRobloxName').value;
            
            const code = giftCodes.find(c => c.code.toLowerCase() === giftCode && c.stock > 0);
            
            if (!code) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-500 text-white p-4 rounded-xl mb-4 text-center font-bold';
                errorDiv.textContent = 'C√≥digo inv√°lido o ya se acab√≥ este regalo üò•';
                giftForm.insertBefore(errorDiv, giftForm.firstChild);
                setTimeout(() => errorDiv.remove(), 3000);
                return;
            }
            
            const product = products.find(p => p.id === code.productId);
            
            if (!product) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-500 text-white p-4 rounded-xl mb-4 text-center font-bold';
                errorDiv.textContent = 'Error: Producto no encontrado';
                giftForm.insertBefore(errorDiv, giftForm.firstChild);
                setTimeout(() => errorDiv.remove(), 3000);
                return;
            }
            
            const whatsappNumber = getWhatsAppNumber();
            
            const whatsappMessage = `üéÅ REGALO CANJEADO - BRAINROT GRATIS üéÆ

üì¶ PRODUCTO: ${product.name}
üí∞ PRECIO: GRATIS üéâ
üé´ C√ìDIGO CANJEADO: ${code.code}

üë§ DATOS DEL CLIENTE:
‚Ä¢ Nombre Real: ${customerName}
‚Ä¢ Usuario Roblox: ${robloxName}

üìÖ Fecha del canje: ${new Date().toLocaleString('es-ES')}

¬°Hola! He canjeado este c√≥digo de regalo üöÄ`;

            const whatsappLink = https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodeURIComponent(whatsappMessage)};
            
            code.stock--;
            
            const order = {
                id: gift_${Date.now()},
                date: new Date().toISOString(),
                product: product.name,
                customer: customerName,
                robloxUser: robloxName,
                originalPrice: 0,
                discount: 0,
                finalPrice: 0,
                hasDiscount: false,
                isGift: true,
                giftCode: code.code
            };
            
            orders.push(order);
            
            try {
                const newWindow = window.open(whatsappLink, '_blank', 'noopener,noreferrer');
                
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    window.location.href = whatsappLink;
                }
            } catch (error) {
                const link = document.createElement('a');
                link.href = whatsappLink;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            giftForm.reset();
            showSuccessOnReturn();
            
            setTimeout(() => {
                giftsSection.classList.add('hidden');
                catalogSection.classList.remove('hidden');
            }, 3000);
        });

        // Handle purchase form
        purchaseForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const customerName = document.getElementById('customerName').value;
            const robloxName = document.getElementById('robloxName').value;
            
            if (!currentProduct) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-500 text-white p-4 rounded-xl mb-4 text-center font-bold';
                errorDiv.textContent = 'Error: No se ha seleccionado un producto.';
                purchaseForm.insertBefore(errorDiv, purchaseForm.firstChild);
                setTimeout(() => errorDiv.remove(), 3000);
                return;
            }

            if (currentProduct.stock === 0) {
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-500 text-white p-4 rounded-xl mb-4 text-center font-bold';
                errorDiv.textContent = 'Lo sentimos, este producto est√° agotado.';
                purchaseForm.insertBefore(errorDiv, purchaseForm.firstChild);
                setTimeout(() => errorDiv.remove(), 3000);
                return;
            }
            
            const whatsappNumber = getWhatsAppNumber();
            
            const hasDiscount = currentProduct.discount > 0;
            const originalPrice = currentProduct.price;
            const discountedPrice = hasDiscount ? calculateDiscountedPrice(originalPrice, currentProduct.discount) : originalPrice;
            
            const whatsappMessage = `üß† NUEVO PEDIDO BRAINROT üéÆ

üì¶ PRODUCTO: ${currentProduct.name}
üí∞ PRECIO ORIGINAL: ${formatPrice(originalPrice)}${hasDiscount ? `
üî• DESCUENTO APLICADO: ${currentProduct.discount}%
üí∏ PRECIO FINAL: ${formatPrice(discountedPrice)}` : ''}

üë§ DATOS DEL CLIENTE:
‚Ä¢ Nombre Real: ${customerName}
‚Ä¢ Usuario Roblox: ${robloxName}

üìÖ Fecha del pedido: ${new Date().toLocaleString('es-ES')}

¬°Hola! Quiero hacer este pedido de brainrot üöÄ`;

            const whatsappLink = https://api.whatsapp.com/send?phone=${whatsappNumber}&text=${encodeURIComponent(whatsappMessage)};
            
            currentProduct.stock--;
            
            const order = {
                id: order_${Date.now()},
                date: new Date().toISOString(),
                product: currentProduct.name,
                customer: customerName,
                robloxUser: robloxName,
                originalPrice: originalPrice,
                discount: currentProduct.discount,
                finalPrice: discountedPrice,
                hasDiscount: hasDiscount,
                isGift: false,
                giftCode: null
            };
            
            orders.push(order);
            
            try {
                const newWindow = window.open(whatsappLink, '_blank', 'noopener,noreferrer');
                
                if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
                    window.location.href = whatsappLink;
                }
            } catch (error) {
                const link = document.createElement('a');
                link.href = whatsappLink;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            purchaseForm.reset();
            showSuccessOnReturn();
            
            setTimeout(() => {
                purchaseSection.classList.add('hidden');
                catalogSection.classList.remove('hidden');
                currentProduct = null;
            }, 6000);
        });

        // Show success message
        function showSuccess() {
            successMessage.classList.remove('hidden');
            
            setTimeout(() => {
                successMessage.classList.add('hidden');
            }, 5000);
        }

        // Initialize the store
        document.addEventListener('DOMContentLoaded', async () => {
            await initializeElementSDK();
            renderCatalog();
        });

        // Make buyProduct global
        window.buyProduct = buyProduct;
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'998161db927a3eeb',t:'MTc2MjA2MjkxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
